<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gemini News App</title>
  <link rel="stylesheet" href="index.css">
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
</head>
<body>
  <div id="app">
    <h1 class="title">Gemini News App</h1>

    <div class="category-selection">
        <button 
            v-for="cat in categories" 
            :key="cat" 
            @click="selectCategory(cat)"
            :class="{ 'active': selectedCategory === cat }"
        >
            {{ cat }}
        </button>
    </div>

    <div v-if="isLoading" class="loading-indicator">
        ニュースを取得中...（RSS取得とGemini APIによるタグ生成のため時間がかかります）
    </div>

    <ul class="article" v-else>
      <li class="article-item" v-for="article in articles" :key="article.id">
        <h2 class="article-title">
            <a :href="article.link" target="_blank" rel="noopener noreferrer">{{ article.title }}</a>
        </h2>
        
        <p class="article-description" v-html="article.description"></p>
        
        <ul class="article-tags">
          <li class="article-tag" v-for="(tag, index) in article.tags" :key="index">{{ tag }}</li>
        </ul>
      </li>
      <li v-if="articles.length === 0 && !isLoading">選択されたカテゴリの記事はありません。</li>
    </ul>
  </div>

  <script>
    new Vue({
      el: '#app',
      data: {
        // app.pyで定義したカテゴリに対応
        categories: ['テクノロジー', '経済', 'スポーツ', '国際'], // 3つ以上のカテゴリ
        selectedCategory: 'テクノロジー', // 初期選択カテゴリ
        articles: [],
        isLoading: false, // ローディング状態
        // Flaskサーバーのエンドポイントを指定
        baseUrl: 'http://127.0.0.1:5000/api/news' 
      },
      // アプリがマウントされたら初期カテゴリのニュースをロード
      mounted() {
        this.loadNews(this.selectedCategory);
      },
      methods: {
        // カテゴリボタンクリック時の処理
        selectCategory(category) {
          if (this.selectedCategory !== category) {
            this.selectedCategory = category;
            this.loadNews(category); // ニュースを動的に切り替える
          }
        },
        // ニュースを取得する処理
        loadNews(category) {
          this.isLoading = true; // ローディング開始
          this.articles = []; // ニュース一覧をクリア
          
          fetch(`${this.baseUrl}/${category}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
              this.articles = data;
              this.isLoading = false; // ローディング終了
            })
            .catch(error => {
              console.error('Error fetching news:', error);
              this.isLoading = false; // ローディング終了
              alert(`ニュースの取得中にエラーが発生しました。サーバー（app.py）が起動しているか確認してください。`);
            });
        }
      }
    });
  </script>
</body>
</html>